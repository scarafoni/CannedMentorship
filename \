from flask import Flask, render_template, request, jsonify
from redis import Redis


# Initialize the Flask application
app = Flask(__name__)
redis = Redis()


@app.route('/')
def index():
    return render_template('index.html')


@app.route('/get_id')
def get_id():
    with open('total_players.txt', 'r+') as f:
        x = f.read()
        f.write((x+1))
        print(x)
        return jsonify(result=x)


@app.route('/instruction_input')
def get_input():
    u_instruct = request.args.get('u_instruct', 0)

    # writ/e the result to the instructions
    with open("instructions.txt", 'a') as f:
        f.write(str(curr_instruct) + ". "+u_instruct+"\n")

    return jsonify(result="recieve input "+u_instruct+" thank you!")


@app.route('/propose_instruct')
def propose_instruct():
    return jsonify(result="test")


@app.route('/vote_input')
def send_choices():
    with open("choices.txt", 'r') as f:
        x = f.read()
        return jsonify(result=x.strip())


@app.route('/get_instructions')
def get_instructions():
    with open("instructions.txt", 'r') as f:
        x = int(f.read().strip())
        x += 1
        x.write(str(x))
        return jsonify(result=x)


if __name__ == '__main__':
    # initialize everything
    with open('instructions.txt', 'w') as instructions,\
        open('total_players', 'w') as total_players,\
            open('propositions.txt', 'w') as propositions:
            total_players.write(0)
            propositions.write('')
            instructions.write('')

    app.debug = True
    app.run()

